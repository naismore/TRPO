# ADR 001: Выбор архитектурного стиля для Такси-сервиса

**Дата:** 23 октября 2023 г.  
**Статус:** Принято  
**Участники:** Архитектурный комитет, Lead Backend Developer, Product Owner

---

## Контекст

При разработке платформы для службы такси мы стоим перед выбором архитектурного стиля системы. Нам необходимо учесть:

- **Высокую нагрузку** в реальном времени (заказы, отслеживание, уведомления)
- **Масштабируемость** под растущее количество пользователей (от 10k до 500k)
- **Надёжность и доступность** (uptime 99,9%)
- **Скорость разработки** MVP и последующих релизов
- **Безопасность** данных и платежей
- **Интеграцию** с внешними сервисами (карты, платежи, SMS)

**Рассмотренные варианты:**

1. **Модульный монолит** – одно приложение с чёткими модулями (заказы, пользователи, платежи и т.д.)
2. **Микросервисы** – независимые сервисы, общающиеся по API (REST/gRPC)
3. **Гибридная архитектура** – монолит для ядра + микросервисы для специфичных нагрузочных модулей
4. **Событийно-ориентированная архитектура (Event-driven)** с шиной сообщений (Kafka, RabbitMQ)

---

## Решение

Выбрана **гибридная архитектура**:

- **Монолитное ядро** для основных бизнес-процессов (заказы, пользователи, водители)
- **Выделенные микросервисы** для специфичных и нагрузочных компонентов (геолокация, уведомления, аналитика)
- **Событийная шина** для асинхронной коммуникации между компонентами

---

## Обоснование

### 1. **Баланс между скоростью разработки и масштабируемостью**

- MVP можно быстро выпустить на монолите, не тратя время на настройку межсервисного взаимодействия
- Критичные по нагрузке компоненты (геолокация, уведомления) изолированы в микросервисы для независимого масштабирования

### 2. **Оптимизация под паттерны использования**

- **Ядро (монолит):** синхронные, связанные операции (создание заказа → списание средств → назначение водителя)
- **Микросервисы:** асинхронные, независимые задачи (отправка 1000 push-уведомлений, расчёт маршрутов)

### 3. **Управление сложностью**

- Чёткое разделение ответственности: монолит = бизнес-логика, микросервисы = инфраструктурные задачи
- Возможность постепенного дробления монолита при росте нагрузки

### 4. **Соответствие нефункциональным требованиям**

- **Производительность:** геосервис масштабируется горизонтально под пиковую нагрузку
- **Надёжность:** падение сервиса уведомлений не ломает процесс заказа
- **Безопасность:** платежный модуль изолирован и проходит отдельный аудит

### 5. **Экономическая эффективность**

- Не переплачиваем за избыточную микросервисность на старте
- Критичные сервисы масштабируются точечно, экономя ресурсы

---

## Недостатки решения

### 1. **Усложнённая DevOps-инфраструктура**

- Нужно поддерживать и монолит, и микросервисы, и шину событий
- Требуется мониторинг двух типов приложений

### 2. **Риски несогласованности данных**

- Асинхронная коммуникация может привести к временной несогласованности (eventual consistency)
- Требуется продуманная стратегия компенсирующих транзакций (Saga pattern)

### 3. **Сложность отладки распределённой системы**

- Трассировка запроса через несколько сервисов требует внедрения distributed tracing (Jaeger, Zipkin)

### 4. **Нагрузка на команду**

- Разработчикам нужно понимать и монолит, и микросервисные паттерны
- Требуется сильный DevOps/SRE для поддержки инфраструктуры

---

## Последствия

### Положительные:

- Быстрый выход на рынок с MVP
    
- Гибкое масштабирование под нагрузку
    
- Отказоустойчивость за счёт изоляции компонентов
    
- Возможность постепенной эволюции архитектуры
    

### Отрицательные (риски):

- Усложнение деплоя и мониторинга
- Необходимость в квалифицированной команде DevOps
- Дополнительные накладные расходы на межсервисное взаимодействие
### Технические следствия:

1. **Внедрить API Gateway** для маршрутизации запросов
2. **Использовать Kafka/RabbitMQ** как шину событий
3. **Настроить Service Mesh** (Istio/Linkerd) для микросервисов
4. **Внедрить Distributed Tracing**
5. **Использовать Kubernetes** для оркестрации микросервисов
6. **Монолит деплоить** как традиционное приложение (Docker + CI/CD)
